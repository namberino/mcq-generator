['## **Báo cáo dựán Mini Project** **IoT Security**\n\n**Người thực hiện:** Nguyễn Bình Nam\n\n\n**Người hướng dẫn:** Trương Chí Tài (VTNet), Hoàng Xuân Hưng (VTNet)\n\n\nNgày chỉnh sửa cuối: Ngày 20 tháng 6 năm 2025', '# **Mục lục**\n\n**Tóm tắt dựán** **3**\n\n\n**1** **Tổng quan vềIoT** **4**\n1.1 IoT là gì? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4\n1.2 Các thành phần trong hệthống IoT . . . . . . . . . . . . . . . 4\n\n\n**2** **Các mối đe dọa vềbảo mật trong IoT** **6**\n2.1 Mối đe dọa tầng cảm biến . . . . . . . . . . . . . . . . . . . . 6\n2.1.1 Khai thác thiết bịvật lý . . . . . . . . . . . . . . . . . 6\n2.1.2 Tấn công side-channel . . . . . . . . . . . . . . . . . . 6\n2.1.3 Chỉnh sửa firmware . . . . . . . . . . . . . . . . . . . . 6\n2.1.4 Ví dụthực tế. . . . . . . . . . . . . . . . . . . . . . . 7\n2.2 Mối đe dọa tầng mạng . . . . . . . . . . . . . . . . . . . . . . 7\n2.2.1 Tấn công phát lại . . . . . . . . . . . . . . . . . . . . . 7\n2.2.2 Man-in-the-Middle (MITM) . . . . . . . . . . . . . . . 7\n2.2.3 Làm nhiễu sóng radio . . . . . . . . . . . . . . . . . . . 7\n2.2.4 Denial of Service (DoS) . . . . . . . . . . . . . . . . . . 7\n2.2.5 Ví dụthực tế. . . . . . . . . . . . . . . . . . . . . . . 8\n2.3 Mối đe dọa tầng ứng dụng . . . . . . . . . . . . . . . . . . . . 8\n2.3.1 Xác thực và quản lý session yếu . . . . . . . . . . . . . 8\n2.3.2 Lỗhổng web . . . . . . . . . . . . . . . . . . .', 'ản lý session yếu . . . . . . . . . . . . . 8\n2.3.2 Lỗhổng web . . . . . . . . . . . . . . . . . . . . . . . . 8\n2.3.3 Ứng dụng mobile lưu trữthông tin không an toàn . . . 8\n2.3.4 Ví dụthực tế. . . . . . . . . . . . . . . . . . . . . . . 8\n\n\n**3** **Các phương pháp khai thác IoT** **9**\n3.1 Mật khẩu yếu, dễđoán . . . . . . . . . . . . . . . . . . . . . . 9\n3.2 Dịch vụmạng không an toàn . . . . . . . . . . . . . . . . . . 10\n3.3 Giao diện ecosystem không an toàn . . . . . . . . . . . . . . . 10\n3.4 Không có cơ chếcập nhật an toàn . . . . . . . . . . . . . . . . 10\n3.5 Sửdụng thành phần phiên bản cũ, thiếu an toàn . . . . . . . 10\n3.6 Bảo vệquyền riêng tư không đầy đủ . . . . . . . . . . . . . . 10\n\n\n1', '3.7 Cơ chếtruyền và lưu trữdữliệu không an toàn . . . . . . . . 11\n3.8 Không có quản lý thiết bị . . . . . . . . . . . . . . . . . . . . 11\n3.9 Cấu hình mặc định không an toàn . . . . . . . . . . . . . . . . 11\n3.10 Không có sựkiên cốvềmặt vật lý . . . . . . . . . . . . . . . . 11\n\n\n**4** **Minh họa** **12**\n4.1 Thiết bịđược sửdụng . . . . . . . . . . . . . . . . . . . . . . 12\n4.2 Setup môi trường . . . . . . . . . . . . . . . . . . . . . . . . . 13\n4.3 Phân tích firmware . . . . . . . . . . . . . . . . . . . . . . . . 14\n4.4 Các lỗhổng được khai thác . . . . . . . . . . . . . . . . . . . 18\n4.4.1 Command injection trong tính năng chuẩn đoán ping . 18\n4.4.2 Command injection trong tính năng DDNS check . . . 21\n4.4.3 Kiểm soát truy cập kém . . . . . . . . . . . . . . . . . 23\n4.4.4 Chỉnh sửa firmware . . . . . . . . . . . . . . . . . . . . 27\n\n\n**5** **Kết luận** **32**\n\n\n2', '# **Tóm tắt dựán**\n\nCác thiết bịIoT (Internet of Things) ngày càng trởthành 1 phần tất yếu\ntrong cuộc sống hiện đại. Với sốlượng thiết bịkết nối đa dạng và dữliệu\nđược thu thập liên tục ngày càng gia tăng, các lỗhổng bảo mật có thểdẫn\nđến những rủi ro nghiêm trọng cho người dùng và doanh nghiệp. Việc đảm\nbảo an toàn và bảo mật cho hệsinh thái IoT là yêu cầu cấp thiết, đòi hỏi\nnhững giải pháp toàn diện từcấp độthiết bịđến mạng lưới kết nối.\n\n\nDựán này sẽđi sâu vào việc tìm hiểu vềhạtầng IoT và phân tích\nbảo mật trong hạtầng đó. Đồng thời, các phương pháp khai thác IoT sẽ\nđược khám phá và một sốlỗhổng bảo mật của thiết bịIoT sẽđược minh\nhọa. Mục tiêu của dựán này là hiểu sâu hơn vềbảo mật cho hệthống IoT\nvà đềcao sựquan trọng của việc xây dựng hệthống bảo mật cho hạtầng\nnày.\n\n\n3', '# **Chương 1** **Tổng quan vềIoT**\n\n### **1.1 IoT là gì?**\n\nInternet of Things (IoT) là một hệthống gồm các thiết bịđược gọi là\n"vật"(Ví dụ: Đèn, điều hòa, xe, v.v). Những thiết bịnày có các bộphận\nđiện tửcho phép chúng có khảnăng tựđộng thu thập dữliệu thông qua\ncảm biến, xửlý và trao đổi dữliệu qua mạng. Những thiết bịnày có thểlà\ncác thiết bịgia dụng đơn giản như router, đèn, điều hóa, hay các thiết bị\nphức tạp như máy móc công nghiệp quy mô lớn\n\n\nĐặc trưng nổi bật của IoT là tính liên thông: Mỗi thiết bịIoT sẽ\nluôn luôn được bật, luôn được kết nối và tương tác với các thiết bịIoT khác\ntrong cùng hệthống. Những giao thức kết nối được sửdụng trong hệthống\nIoT cần được tối ưu cho hệthống năng lượng thấp và ít tài nguyên tính\ntoán. Một đặc trưng khác của những thiết bịIoT này là các thiết bịnày có\nkhảnăng thu thập thông tin bằng các cảm biến và xửlý thông tin đó trong\nthời gian thực. Với sựtăng trưởng vượt bậc của hệsinh thái IoT trên thếgiới, được\ndựđoán là sốlượng thiết bịIoT trên thếgiới sẽtăng đến 41.1 tỷthiết bị\nvào năm 2030, việc xây dựng bảo mật cho các thiết bịIoT là một điều cần\nthiết.', 'g đến 41.1 tỷthiết bị\nvào năm 2030, việc xây dựng bảo mật cho các thiết bịIoT là một điều cần\nthiết. [1]\n\n### **1.2** **Các thành phần trong hệthống IoT**\n\n\nMột hệthống IoT sẽbao gồm nhiều thành phần khác nhau, mỗi thành phần\nđều có những tác động riêng đến bảo mật của hệthống. Kiến trúc hệthống\nIoT có thểđược chia thành 3 tầng: Cảm biến, Mạng, và Ứng dụng. [2]\n\n\n4', '**Tầng Cảm biến:**\n\n\n  Gồm các vi điều khiển, cảm biến, bộtruyền động và các giao thức qua\ndây. Một sốgiao thức qua dây cho IoT phổbiến: UART, JTAG, I2C, SPI,\n\nv.v. Các thiết bịnày rất hạn chếvềmặt tài nguyên. Tài nguyên tính toán\nthấp và bộnhớhạn chếđồng nghĩa với việc các biện pháp bảo mật dựa\ntrên phần mềm như mật mã phải nhẹvà tối ưu. Những thiết bịnày cần bảo vệphần cứng tốt do các cuộc tấn công vật\nlý có khảnăng xảy ra với các thiết bịnày. **Tầng Mạng:**\n\n\n  Hệthống IoT sửdụng nhiều loại giao thức mạng khác nhau cho việc\ngiao tiếp không dây ởcác tầm khoảng cách khác nhau: ngắn, trung và\ndài. Một sốgiao thức mạng IoT phổbiến: Bluetooth Low Energy (BLE),\nWi-Fi, LoRaWAN, Zigbee, NB-IoT, LTE-M, v.v. Những giao thức không dây này cần được bảo vệvà mã hóa một cách\nnghiêm ngặt khỏi các cuộc tấn công mạng. **Tầng Ứng dụng:**\n\n\n  Hầu hết thiết bịIoT đều cần một ứng dụng hoặc giao diện đểtương\ntác: web, ứng dụng di động, ứng dụng desktop. Một sốgiao thức ởtầng ứng dụng phổbiến cho IoT: HTTP/HTTPS,\nCoAP, MQTT, v.v. Giống như trong các ứng dụng thông thường, các giao thức này có thể\nbịkẻtấn công lợi dụng cho mục đích xấu, đặc biệt là những giao thức\nthiết kếriêng cho IoT như MQTT.', '\nbịkẻtấn công lợi dụng cho mục đích xấu, đặc biệt là những giao thức\nthiết kếriêng cho IoT như MQTT. Bên cạnh đó, chính ứng dụng cũng\ncó thểtồn tại các lỗhổng tấn công web và app điển hình. 5', '# **Chương 2** **Các mối đe dọa vềbảo mật** **trong IoT**\n\nHệsinh thái IoT đã tạo ra một môi trường đe dọa đa tầng. Các mối đe dọa\nvềmặt bảo mật trong IoT có thểđược được phân loại theo các tầng khác\nnhau trong kiến trúc IoT, đồng thời các phương thức khai thác có thểcó các\nhậu quảkhác nhau.\n\n### **2.1** **Mối đe dọa tầng cảm biến**\n\n#### **2.1.1 Khai thác thiết bịvật lý**\n\n\nNhiều nhà sản xuất thiết bịIoT thường đểlộchân UART/JTAG hoặc bật\nchếđộconsole gỡlỗi ngay trên thiết bịthương mại. Khi có quyền truy cập vật\nlý, kẻtấn công có thểtrích xuất dữliệu từbộnhớflash, trích xuất firmware,\nchiếm quyền shell root hoặc thậm chí cài đặt firmware có chứa mã độc. [3]\n\n#### **2.1.2 Tấn công side-channel**\n\n\nBằng cách theo dõi mức tiêu thụđiện năng hay bức xạđiện từcủa thiết bị\nkhi thực hiện các phép toán mã hóa và giải mã, người tấn công có thểchiết\nxuất khóa bí mật dùng đểmã hóa/giải mã hoặc trộm cắp dữliệu nhạy cảm\nbên trong. [4]\n\n#### **2.1.3 Chỉnh sửa firmware**\n\n\nMột người tấn công có thểlợi dụng việc thiếu cơ chếxác thực chặt chẽtrong\nquá trình cập nhật firmware qua OTA (Over-The-Air). Họcó thểkhiến thiết\n\n\n6', 'bịcài đặt firmware đã chỉnh sửa nếu chức năng OTA không có bảo mật tốt. Ngoài ra, việc can thiệp trực tiếp qua cổng nạp (flashing) cũng cho phép\nhacker ghi đè firmware gốc. #### **2.1.4 Ví dụthực tế**\n\n\nVào năm 2024, một nhà nghiên cứu bảo mật đã minh họa cuộc tấn công vào\nhệthống đăng nhập vào root shell của thiết bịcamera an ninh VStarcam. Bằng cách trích xuất firmware từchip SPI đểlấy được mật khẩu root và\nkết nối với root shell qua UART, họcó thểlấy được root shell và trích xuất\nthêm thông tin vềthiết bịđó cho các cuộc tấn công khác. [5]\n\n### **2.2** **Mối đe dọa tầng mạng**\n\n#### **2.2.1 Tấn công phát lại**\n\n\nỞdạng tấn công này, người tấn công có thểbắt và ghi lại sóng radio phát\nra từthiết bịIoT và phát lại sau đó. Điều này cho phép họthực thi lệnh mà\nkhông cần xác thực, do thiếu cơ chếmã hóa và token phiên làm việc với thời\ngian hết hạn ngắn. [6]\n\n#### **2.2.2 Man-in-the-Middle (MITM)**\n\n\nBằng cách sửdụng spoofing hoặc tạo các điểm truy cập (AP) giả, kẻxấu có\nthểđọc và thậm chí thay đổi các gói tin từgiữa các thiết bị. Hậu quảlà lộ\nlọt thông tin hoặc bịchỉnh sửa nội dung ban đầu.', 'y đổi các gói tin từgiữa các thiết bị. Hậu quảlà lộ\nlọt thông tin hoặc bịchỉnh sửa nội dung ban đầu. #### **2.2.3 Làm nhiễu sóng radio**\n\n\nNgười tấn công có thểphát tín hiệu cùng tần sốvới thiết bị, chặn các gói tin\ndữliệu, khiến cảm biến hoặc thiết bịtruyền động không nhận được gói tin\nvà không phản hồi. [7]\n\n#### **2.2.4 Denial of Service (DoS)**\n\n\nDo hạn chếnặng vềtài nguyên, thiết bịIoT có thểdễdàng bịtấn công DoS. Một cuộc tấn công DoS có thểlàm gián đoạn dịch vụcủa thiết bị. Với các\nthiết bịmạng như gateway hay router, DoS thậm chí có thểlàm đứt kết nối\ntoàn bộhệthống IoT, gây ra gián đoạn quy mô lớn. 7', '#### **2.2.5 Ví dụthực tế**\n\nMirai botnet: Botnet này lợi dụng tính bảo mật kém của các thiết bịIoT. Botnet này lây lan qua nhiều phương thức như mật khẩu mặc định, mã hóa\nyếu, v.v. Mirai botnet đã thực hiện một sốcuộc tấn công DDoS lớn nhất\ntrên thếgiới. Vì mã nguồn đã được công khai, đã xuất hiện nhiều biến thể\nMirai khác nhau. [8]\n\n### **2.3** **Mối đe dọa tầng ứng dụng**\n\n#### **2.3.1 Xác thực và quản lý session yếu**\n\n\nWebsite hoặc ứng dụng di động của hệthống IoT có thểlưu trữmật khẩu\nyếu hoặc quản lý session không đúng cách. Điều này có thểtạo cơ hội cho\nkẻtấn công sửdụng brute-force và hijack session. #### **2.3.2 Lỗhổng web**\n\n\nWebsite của thiết bịcó thểtồn tại các lỗhổng như XSS, CSRF, command\ninjection, broken access control. . . Điều này cho phép kẻtấn công leo thang\nquyền hạn, đào sâu hơn vào hệthống và rò rỉthông tin. #### **2.3.3 Ứng dụng mobile lưu trữthông tin không an toàn**\n\n\nỨng dụng di động của hệthống IoT, nếu có lưu trữAPI key, thông tin đăng\nnhập hay certificate của thiết bịdưới plaintext trên bộnhớmáy hoặc sử\ndụng mã hóa hoặc obfuscation kém, sẽcó khảnăng bịngười tấn công đánh\ncắp các thông tin này khi điện thoại bịroot hoặc mất.', 'cation kém, sẽcó khảnăng bịngười tấn công đánh\ncắp các thông tin này khi điện thoại bịroot hoặc mất. Hacker có thểlợi dụng\nđểtruy cập và tấn công hệthống IoT. #### **2.3.4 Ví dụthực tế**\n\n\nVào 2017, thông tin vềngười dùng của sản phẩm CloudPets (đồchơi kết nối\nvới mạng) đã bịrò rỉ. Sản phẩm này có yêu cầu mật khẩu kém, dễbịbrute\nforce. Thông tin vềngười dùng cũng được lưu lại trong database không được\nbảo vệtốt, cho phép người tấn công truy cập tuy không được cho phép. [9]\n\n\n8', '# **Chương 3** **Các phương pháp khai thác IoT**\n\nSau đây là một sốphương pháp khai thác hệthống IoT. Những phương pháp\nnày được liệt kê trong danh sách OWASP IoT Top 10. [10] [11]\n\n### **3.1** **Mật khẩu yếu, dễđoán**\n\n\nNhiều thiết bịIoT sửdụng mật khẩu yếu, dễbịbrute-force, có thểbịtìm\ntrên mạng. Hơn nữa, một sốthiết bịhardcode mật khẩu một bộphận nào\ncủa thiết bịnhư firmware, dẫn đến khảnăng người tấn công có khảnăng\ntrích xuất mật khẩu từbộphận đó của thiết bị. Hậu quảlà các người tấn\ncông có thểtruy cập vào thiết bịđó mà không được phép.\n\n\n9', '### **3.2 Dịch vụmạng không an toàn**\n\nNhững dịch vụmạng không cần thiết hoặc không an toàn, có tính bảo mật,\nmã hóa kém chạy trên thiết bịlà một điểm yếu trầm trọng, nhất là các dịch\nvụcó kết nối với Internet. Người tấn công có thểtrích xuất thông tin nhạy\ncảm, tấn công các hệthống khác có kết nối với thiết bịđã bịtấn công, hoặc\ntruy cập vào thiết bịmà không được phép. ### **3.3 Giao diện ecosystem không an toàn**\n\n\nCác giao diện web, API, cloud, hoặc di động cho các thiết bịIoT nếu không\nđược bảo vệan toàn (thiếu xác thực, mã hóa, filter đầu vào và ra) có thểsẽ\nmởra hướng tấn công vào thiết bịhoặc các bộphận trong thiết bịđó. ### **3.4** **Không có cơ chếcập nhật an toàn**\n\n\nNếu thiết bịkhông có cơ chếcập nhật an toàn (Xác thực firmware, mã hóa\ntrong lúc chuyển giao firmware, cơ chếchống rollback, thông báo người dùng\nvềcập nhật firmware) thì các thiết bịnày có khảnăng bịtấn công chỉnh sửa\nfirmware và các bộphận hệthống quan trọng. ### **3.5** **Sửdụng thành phần phiên bản cũ, thiếu** **an toàn**\n\n\nViệc sửdụng các bộphận phần mềm và thư viện cũ, thiếu an toàn sẽcho\nphép người tấn công khai thác các lỗhổng đã có trong các phiên bản cũ và\nthiếu an toàn đó.', 'oàn sẽcho\nphép người tấn công khai thác các lỗhổng đã có trong các phiên bản cũ và\nthiếu an toàn đó. Thêm nữa, thiết bịIoT cũng có thểsửdụng phần cứng từ\nmột supply chain đã bịtấn công. ### **3.6** **Bảo vệquyền riêng tư không đầy đủ**\n\n\nMột sốthiết bịthu thập thông tin cá nhân của người dùng trong thiết bị\nhoặc hệsinh thái và được sửdụng một cách không an toàn (lưu hoặc chuyển\ngiao mà không mã hóa) và không được người dùng cho phép. Những thiết bị\nnày cần bảo vệquyền riêng tư theo tiêu chuẩn quốc tế. 10', '### **3.7 Cơ chếtruyền và lưu trữdữliệu không** **an toàn**\n\nThiếu mã hóa và access control cho các dữliệu nhạy cảm trong hệsinh thái\nIoT (bao gồm dữliệu at rest, in transit, và during processing), dẫn đến người\ntấn công có thểthu thập các dữliệu nhạy cảm này. ### **3.8** **Không có quản lý thiết bị**\n\n\nKhông quản lý tốt vềmọi mặt của thiết bị(quản lý update, giám sát thiết\nbị, loại bỏthiết bịmột cách an toàn), các thiết bịIoT có thểdẫn đến cảhệ\nthống mạng bịtấn công. Việc quản lý thiết bịcần được bảo mật tốt, nếu\nkhông thì có thểdẫn đến truy cập trái phép, chỉnh sửa cấu hình và firmware,\nhoặc điều khiển thiết bị. ### **3.9** **Cấu hình mặc định không an toàn**\n\n\nCác thiết bịhoặc hệthống IoT không có cấu hình mặc định an toàn hoặc\nkhông có cơ chếchỉnh sửa cấu hình của thiết bịsẽdẫn đến rủi ro vềmặt\nbảo mật cao, cho phép người tấn công truy cập trái phép vào thiết bịbằng\ncách lợi dụng những cấu hình đó. Những cấu hình này có thểlà thông tin\nđăng nhập, cổng được mở, protocol giao tiếp không được mã hóa hoặc mã\nhóa kém. ### **3.10** **Không có sựkiên cốvềmặt vật lý**\n\n\nSựkiên cốvềmặt vật lý, phần cứng cho các thiết bịIoT là một yếu tố\ncần thiết.', 'iên cốvềmặt vật lý**\n\n\nSựkiên cốvềmặt vật lý, phần cứng cho các thiết bịIoT là một yếu tố\ncần thiết. Nếu như thiết bịkhông có các phương pháp chống đo điện áp,\nkhông tắt các cổng debug, không có phương pháp xác thực tính toàn vẹn của\nfirmware, người tấn công có thểtrích xuất thông tin nhạy cảm như khóa bí\nmật từthiết bịbằng các phương pháp tấn công phần cứng và sửdụng thông\ntin này cho các cuộc tấn công từxa hoặc tấn công chiếm quyền điều khiển\nthiết bị. 11', '# **Chương 4** **Minh họa**\n\n### **4.1** **Thiết bịđược sửdụng**\n\nThiết bịđược sửdụng cho việc minh họa các lỗhổng trên hệthống IoT là\nthiết bịDIR-820L của D-Link. Thiết bịnày là một thiết bịrouter được sản\nxuất từnăm 2013. Dựán này sẽminh họa 5 lỗhổng khác nhau còn tồn\ntại trên firmware mới nhất của thiết bịnày. Dưới đây là hình ảnh thiết bị\nDIR-820L được lấy từmột trang web bán thiết bị. [12]\n\n\n12', '### **4.2 Setup môi trường**\n\n**Các công cụđược sửdụng:**\n\n\n  - **FirmAE** : Công cụtựđộng hóa quá trình trích xuất và thiết lập tiến\ntrình mô phỏng cho firmware của các thiết bịIoT.\n\n\n  - **Binwalk** : Công cụtrích xuất hệthống file được chứa trong firmware.\n\n\n  **Firmware mod kit (fmk)** : Công cụcho phép trích xuất, chỉnh sửa,\nvà gói lại hệthống file của firmware.\n\n\n  - **Ghidra** : Công cụdịch ngược mã nguồn mởvới hỗtrợcho các cấu trúc\nvi xửlý trong IoT như ARM và MIPS.\n\n\n  **Burp Suite** : Công cụvới nhiều tính năng giúp phân tích các gói tin\nHTTP/HTTPS mạng.\n\n\n**Môi trường phân tích:**\n\n\n13', '### **4.3 Phân tích firmware**\n\nPhân tích firmware với công cụ **binwalk** cho thấy hệthống file SquashFS\nẩn bên trong firmware. SquashFS là hệthống file phổbiến trên các thiết bị\nnhúng, chủyếu được sửdụng cho phân vùng root vì tính chất read-only của\nnó giúp giảm nguy cơ thiết bịbịhỏng do các thay đổi không mong muốn\nlên hệthống tập tin gốc.\n\n\n14', 'Chúng ta có thểtrích xuất hệthống file SquashFS này bằng tính năng trích\nxuất của binwalk\n\n\nTrong hệthống file này, chúng ta có thểthấy được file **shadow** có chứa bản\n\n\n15', 'hash của mật khẩu người dùng root. Sau khi chạy file này qua **john the**\n**ripper**, mật khẩu của người dùng root đã được phá, mật khẩu này là **root** .\n\n\nTiếp đó, file khởi động **rcS** cho thấy firmware sẽkhởi tạo hai dịch vụ\n**bulkListen** và **ncc2** khi thiết bịbắt đầu hoạt động. Dịch vụ **ncc2** được\nsửdụng đểxửlý các yêu cầu theo chuẩn **Common Gateway Interface**\n**(CGI)** . CGI là một chuẩn giao tiếp cho phép máy chủweb thực thi các\nchương trình bên ngoài đểxửlý các yêu cầu HTTP/HTTPS. Tập tin thực\nthi của **ncc2** có thểđược tìm thấy tại thư mục **/sbin** .\n\n\n16', 'Firmware này chạy trên kiến trúc vi xửlý MIPSEB 32-bit. Công cụdịch\nngược Ghidra, một công cụmã nguồn mởvới khảnăng hỗtrợtốt cho\nkiến trúc MIPS, đã được sửdụng cho các công đoạn dịch ngược của dựán này.\n\n\nCông cụ **checksec** thông báo rằng file nhịphân **ncc2** này cũng không có\ncác chức năng bảo vệlỗhổng overflow. File này cũng không có biểu tượng\ndebug, làm cho công đoạn dịch ngược khó hơn.\n\n\n17', '### **4.4** **Các lỗhổng được khai thác**\n\n#### **4.4.1 Command injection trong tính năng chuẩn đoán** **ping**\n\nLỗhổng này có mã CVE là **CVE-2024-51186** [13]. Đây là lỗhổng trong\ndịch vụ **ncc2** của thiết bịnày. Trong dịch vụ **ncc2** này, có một endpoint xử\nlý CGI request là **ping.ccp** . Endpoint này cho phép chuẩn đoán các thiết\nbịqua mạng bằng cách "ping"các thiết bịđó. Dưới đây là ảnh giao diện cho\nphép người dùng tương tác với tính năng này.\n\n\n18', 'Dưới đây là một request tới **ping.ccp** đã được bắt trong Burp Suite:\n\n\nSau khi dịch ngược file **ncc2**, chúng ta có thểthấy được là hàm\n**FUN_0049e128** sẽxửlý các POST request tới **ping.ccp** . Hàm này\nsẽlấy địa chỉping từtham số **ping_addr** trong request.\n\n\n19', 'Địa chỉping được đưa qua hàm **hasInjectionString**, nhập từthư viện\n**libleopard.so** . Hàm này kiểm tra sựtồn tại của bốn ký tựthường dùng cho\ncommand injection: "‘", "\\", ";", "’"và " _|_ ". Nếu hàm này phát hiện bất kỳ\nký tựnào trong sốnày trong đầu vào của người dùng thì yêu cầu sẽkhông\nđược xửlý.\n\n\n20', 'Tuy nhiên, hàm **hasInjectionString** không kiểm tra hết mọi ký tựtách\nlệnh và có khảnăng được sửdụng cho command injection. Một người tấn\ncông có thểchèn lệnh thông qua ký tựxuống dòng **\\n** (Mã hex là **0x0A** ).\nTừlỗhổng này, chúng ta có thểthực hiện chèn lệnh đểtạo một bind shell\nbằng **telnet** mởởcổng 9999.\n\n\nĐểcó thểphòng chống lỗhổng này, hàm **hasInjectionString** cần black list\ntổng quan hơn, bao gồm nhiều kí tựinjection hơn. Ngoài ra, chúng ta cũng\ncó thểchuyển sang sửdụng white list thay vì black list và chỉtập trung vào\ncác kí tựđược cho phép trong một địa chỉIP.\n\n#### **4.4.2 Command injection trong tính năng DDNS** **check**\n\n\nLỗ hổng này có mã CVE là **CVE-2021-45382** [14]. Endpoint\n**ddns_check.ccp** có lỗ hổng dẫn tới command injection. Hàm\n**callback_ccp_ddns_check** là hàm xử lý các request tới\n\n.\n**ddns_check.ccp**\n\n\n21', 'Hàm **callback_ccp_ddns_check** có sửdụng hàm **doCheck** (được sử\ndụng khi tham số **ccp_act** trong request tới **ddns_check.ccp** được set\nthành **doCheck** ) đểthu thập thông tin DDNS: Tên host, tên người dùng,\nmật khẩu.\n\n\nNhững tham sốnày sẽđược đưa vào hàm **system** . Hàm này sẽchạy\n**ddns_check.c** đểxửlý request.\n\n\nHàm **doCheck** này không có bất kì chức năng nào đểkiểm tra xem đầu vào\ncó bịcommand injection hay không. Dưới đây là minh họa một payload mở\n\n\n22', 'dịch vụtelnet trên cổng 9999 qua command injection vào **ddns_check.ccp** .\nScan Nmap của router cho thấy rằng cổng 9999 đã được mởvà có dịch vụ\nlà telnet.\n\n\nĐểcó thểchống lỗhổng này, hàm **doCheck** cần kiểm tra đầu vào xem có\nký tựinjection nào không bằng white list.\n\n#### **4.4.3 Kiểm soát truy cập kém**\n\n\nGhi chú: Lỗhổng này chưa có mã CVE chính thức.\n\n\nThiết bịDIR-820L không có access control an toàn. Các CGI request\nkhông xác thực session người dùng trước khi xửlý. Thiết bịnày chỉcó một\ncookie là **hasLogin** có giá trịlà 0 hoặc 1. Người tấn công có thểbắt các\nrequest của thiết bịnày, chỉnh sửa nó, và gửi đến thiết bị. Bởi vì không có\ntoken xác thực người dùng, thiết bịnày sẽxửlý bất kì request nào, kểcả\nrequest không đến từngười dùng, cho phép người tấn công chỉnh sửa cấu\nhình của máy đó.\n\n\nChức năng chỉnh sửa mật khẩu admin sẽđược sửdụng đểminh họa\nlỗhổng này. Hàm **FUN_00451208** là hàm xửlý request tới chỉnh sửa\nthông tin cấu hình trong thiết bị.\n\n\n23', 'Mật khẩu mặc định sẽđược đọc từfile cấu hình **/sbin/defaultCfg.txt** .\nKhi mà firmware được load vào thiết bịvà bắt đầu thực thi, file cấu hình đó\nsẽđược copy vào **/var/tmp/cfg.txt** . Bất kì chỉnh sửa vềcấu hình nào sẽ\nđược ghi vào file **cfg.txt** này.\n\n\nHàm **pure_SetDeviceSettings** xửlý request thay đổi mật khẩu admin.\n\n\n24', 'Hàm này sẽsửdụng **sendEvent** đểđiều chỉnh file cấu hình trong\n**/var/tmp** .\n\n\n25', 'Dịch vụ **ncc2** không có chức năng kiểm tra danh tính người dùng hoặc\nkiểm tra mật khẩu cũ trước khi cho phép thay đổi cấu hình. Điều này\ncho phép người tấn công có thểgửi một request tới **get_set.ccp** mà\nkhông cần đăng nhập hoặc biết mật khẩu cũ và vẫn có thểthay đổi mật\nkhẩu admin. Dưới đây là một request thay đổi mật khẩu gửi từmáy attacker.\n\n\nRequest này khi gửi tới router thì sẽthay đổi file cấu hình. Dưới đây là file\n\n\n26', 'cấu hình đã được thay đổi sau khi request trên được gửi tới router:\n\n\nĐểcó thểchống lỗhổng này, thiết bịnày cần thiết lập quản lý session người\ndùng tốt đểphòng chống attacker gửi các request không được xác thực. Hơn\nnữa, thiết bịnày cần yêu cầu mật khẩu cũ khi thay đổi những các cấu hình\nquan trọng như mật khẩu của tài khoản admin.\n\n#### **4.4.4 Chỉnh sửa firmware**\n\n\nGhi chú: Lỗhổng này chưa có mã CVE chính thức.\n\n\nPhương pháp khai thác này có thểđược thực hiện nếu firmware không được\nmã hoắvà thiết bịkhông sửdụng secure boot. Nếu như người tấn công có\nthểtiếp xúc trực tiếp với thiết bịthì họcó thểchỉnh sửa firmware. Họsẽ\ntrích xuất firmware của thiết bị, giải nén firmware đó, chỉnh sửa hoặc đưa\nmã độc của mình vào firmware, và flash firmware đã được chỉnh sửa đó lên\nthiết bị.\n\n\nFirmware của thiết bịnày có thểđược tải trên mạng qua đường link\nchính thức của D-Link [15]. Firmware này có thểđược điều chỉnh bằng công\ncụFirmware Mod Kit (fmk) và flash lên thiết bị. Đầu tiên, fmk sẽtrích\nxuất hệthống file SquashFS trong firmware ra **fmk/rootfs** .\n\n\n27', 'Sau khi đã trích xuất hệthống file, chúng ta có thểthay đổi firmware hoặc\nđưa mã độc vào firmware. Đểminh họa, file **rcS** trong **/etc/init.d**, được sử\ndụng đểchạy chương trình tại thời gian boot, đã được chỉnh sửa sẽmởdịch\nvụtelnet ởcổng 9999.\n\n\nSau khi chỉnh sửa firmware xong, chúng ta có thểdùng fmk đểnén hệthống\n\n\n28', 'file này thành một file **.bin** .\n\n\nVới firmware đã được chỉnh sửa, chúng ta có thểflash cái firmware này lên\nthiết bịqua tính năng emergency flash của D-Link [16]. Hiện tại, em không\ncó thiết bịthật thếnên em sẽmô phỏng firmware đã được chỉnh sửa này\nbằng FirmAE.\n\n\n29', 'Với firmware này, đểcó thểkết nối được với thiết bịthì người tấn công cần\nởchung mạng với router. Đểcó thểkết nối qua mạng Internet, firmware sẽ\ncần có một chương trình backdoor có khảnăng mởreverse shell tới server\ncủa người tấn công bằng **netcat** . Bản **busybox** của firmware hiện tại không\ncó netcat, vậy chúng ta sẽcần import một phiên bản busybox cho kiến\ntrúc vi xửlý MIPSEB có bao gồm netcat vào firmware này. Em đã sửdụng\nMIPSEB busybox v1.21.1. [17]\n\n\nSau khi import **busybox** vào hệthống file của firmware, chúng ta có\nthểtạo ra một script mởreverse shell trong firmware. Script này sẽcheck\nxem thiết bịnày có kết nối internet không và chỉmởreverse shell nếu\nnhư có kết nối Internet. Nếu có kết nối Internet thì **netcat** sẽkết nối tới\nđịa chỉIP trong script ởcổng 4444 và mởshell cho phép tương tác với thiết bị.\n\n\nKhi mô phỏng firmware đã được chỉnh sửa thì chúng ta có thểthấy được là\nfirmware sẽkết nối tới cổng 4444 bằng netcat.\n\n\n30', 'Đểcó thểchống phương pháp khai thác này, firmware cần được mã hóa.\nThiết bịIoT cũng có thểsửdụng **TPM** (Trusted Platform Module) cho\ncông đoạn giải mã và mã hóa. Thiết bịnày cũng có thểsửdụng secure boot\nđểchống việc load firmware không có chữký hợp lệ.\n\n\n31', '# **Chương 5** **Kết luận**\n\nBảo mật cho IoT là một thách thức do hàng tỷthiết bịkết nối, từbộđiều\nnhiệt gia đình đến cảm biến công nghiệp, ngày càng gia tăng. Những thiết bị\nnày thường gặp phải các vấn đềnhư xác thực yếu, kênh truyền không được\nmã hóa và cơ chếcập nhật firmware không an toàn, tất cảđều mởđường\ncho các cuộc tấn công như MITM, phát lại gói tin, can thiệp vào firmware\nvà dò mật khẩu. Dựán này đã thảo luận vềcác mối đe dọa IoT, xác định\ncác phương thức khai thác thực tiễn. Các lỗhổng trên router DIR-820L\nđã minh họa rủi ro lớn trong thiết bịIoT và các điểm yếu cần được khắc phục.\n\n\nĐểbảo mật được hệsinh thái IoT đòi hỏi một cách tiếp cận tổng\nthểtrên nhiều thành phần của hệthống. Dựán với thiết bịD-Link\nDIR-820L cho thấy các cách các thiết bịIoT có thểbịkhai thác và cách bảo\nvệcác thiết bịnày khỏi những cuộc tấn công này, mởhướng cho các triển\nkhai IoT an toàn và bền vững hơn.\n\n\n32', '# **Tài liệu tham khảo**\n\n\n[1] Satyajit Sinha, “State of IoT 2024: Number of connected IoT devices\ngrowing 13% to 18.8 billion globally,” _IoT Analytics_ [, 2024, Link: https:](https://iot-analytics.com/number-connected-iot-devices/)\n[//iot-analytics.com/number-connected-iot-devices/.](https://iot-analytics.com/number-connected-iot-devices/)\n\n\n[2] Kitrum, “Three Layer Architecture in the Internet of\nThings.', 'om/number-connected-iot-devices/)\n\n\n[2] Kitrum, “Three Layer Architecture in the Internet of\nThings. An Examination of Specifications and Security\nThreats,” _Kitrum_ _Blog_, 2023, Link: [https://kitrum.com/blog/](https://kitrum.com/blog/three-layer-architecture-in-the-internet-of-things/)\n[three-layer-architecture-in-the-internet-of-things/.](https://kitrum.com/blog/three-layer-architecture-in-the-internet-of-things/)\n\n\n[3] Matt Brown, “Finding UART and Getting a Root Shell on a Linux\nRouter,” _YouTube_ [, 2022, Link: https://www.youtube.com/watch?app=](https://www.youtube.com/watch?app=desktop&v=HWJddAd2T5Q)\n[desktop&v=HWJddAd2T5Q.](https://www.youtube.com/watch?app=desktop&v=HWJddAd2T5Q)\n\n\n[4] Wikipedia, “Side-channel attack,” _Wikipedia_ [, 2004, Link: https://en.](https://en.wikipedia.org/wiki/Side-channel_attack)\n[wikipedia.org/wiki/Side-channel_attack.](https://en.wikipedia.org/wiki/Side-channel_attack)\n\n\n[5] Matt Brown, “Uncovering Hardcoded Root Password in VStarcam\nCB73 Security Camera,” _Brown Fine Security_ [, 2024, Link: https://](https://brownfinesecurity.com/blog/vstarcam-cb73-hardcoded-root-password/)\n[brownfinesecurity.com/blog/vstarcam-cb73-hardcoded-root-password/', '.](https://brownfinesecurity.com/blog/vstarcam-cb73-hardcoded-root-password/)\n\n\n[6] Krishna Gupta, “IoT Replay Attacks: Safeguarding Business\nIntegrity and Security,” _Blog_, 2024, Link: [https://krishnag.ceo/](https://krishnag.ceo/blog/iot-replay-attacks-safeguarding-business-integrity-and-security/)\n[blog/iot-replay-attacks-safeguarding-business-integrity-and-security/.](https://krishnag.ceo/blog/iot-replay-attacks-safeguarding-business-integrity-and-security/)\n\n\n[7] Wikipedia, “Radio jamming,” _Wikipedia_, 2005, Link: [https://en.](https://en.wikipedia.org/wiki/Radio_jamming)\n[wikipedia.org/wiki/Radio_jamming.](https://en.wikipedia.org/wiki/Radio_jamming)\n\n\n[8] Flashpoint Intel Team, “Mirai Botnet: When Vulnerabilities Travel\nDownstream,” _Flashpoint_, 2016, Link: [https://flashpoint.io/blog/](https://flashpoint.io/blog/mirai-botnet-when-vulnerabilities-travel-downstream/)\n[mirai-botnet-when-vulnerabilities-travel-downstream/.](https://flashpoint.io/blog/mirai-botnet-when-vulnerabilities-travel-downstream/)\n\n\n[9] Alex Hern, “CloudPets stuffed toys leak details of\nhalf a million users,” _The_ _Guardian_, 2017, Link:\n[https://www.theguardian.com/technology/2017/feb/28/](https://ww', 'w.theguardian.com/technology/2017/feb/28/cloudpets-data-breach-leaks-details-of-500000-children-and-adults/)\n[cloudpets-data-breach-leaks-details-of-500000-children-and-adults/.](https://www.theguardian.com/technology/2017/feb/28/cloudpets-data-breach-leaks-details-of-500000-children-and-adults/)\n\n\n33', ' [10] OWASP Foundation, “OWASP IoT Top 10,” _OWASP Wiki_, 2018, Link:\n[https://owasp.org/www-project-internet-of-things/.](https://owasp.org/www-project-internet-of-things/)\n\n\n[11] Vumetric, “Understanding the OWASP IoT Top 10 Security\nRisks,” _Vumetric Blog_ [, 2018, Link: https://www.vumetric.com/blog/](https://www.vumetric.com/blog/what-is-the-owasp-iot-top-10/)\n[what-is-the-owasp-iot-top-10/.](https://www.vumetric.com/blog/what-is-the-owasp-iot-top-10/)\n\n\n[12] Dương Long, “Router D-Link DIR 820L Image,” _Dương Long_, Link:\n[https://duonglong.vn/thiet-bi-mang-router-d-link-dir-820l.](https://duonglong.vn/thiet-bi-mang-router-d-link-dir-820l)\n\n\n[13] 4hsienyang, “CVE-2024-51186,” _National Vulnerability Database_, 2024,\n[Link: https://nvd.nist.gov/vuln/detail/CVE-2024-51186.](https://nvd.nist.gov/vuln/detail/CVE-2024-51186)\n\n\n[14] doudoudedi, “CVE-2021-45382,” _National Vulnerability Database_, 2021,\n[Link: https://nvd.nist.gov/vuln/detail/CVE-2021-45382.](https://nvd.nist.gov/vuln/detail/CVE-2021-45382)\n\n\n[15] D-Link, “DIR-820L Firmware Version 1.05B03,” _D-Link_, Link:\n[https://legacyfiles.us.dlink.com/DIR-820L/REVA/FIRMWARE/](https://legacyfiles.us.dlink.com/DIR-820L/REVA/FIRMW', 'ARE/DIR-820L_REVA_FIRMWARE_1.05B03.ZIP)\n[DIR-820L_REVA_FIRMWARE_1.05B03.ZIP.](https://legacyfiles.us.dlink.com/DIR-820L/REVA/FIRMWARE/DIR-820L_REVA_FIRMWARE_1.05B03.ZIP)\n\n\n[16] s196635, “Emergency Flashing HOW-TO,” _D-Link Forum_ [, Link: http:](http://forums.dlink.com/index.php?topic=44909.0)\n[//forums.dlink.com/index.php?topic=44909.0.](http://forums.dlink.com/index.php?topic=44909.0)\n\n\n[17] Busybox, “Busybox v1.21.1 Download,” _Busybox Downloads_, Link:\n[https://busybox.net/downloads/binaries/1.21.1/.](https://busybox.net/downloads/binaries/1.21.1/)\n\n\n34']